{"version":3,"file":"entry-point.transform.js","sourceRoot":"","sources":["../../../../src/lib/ng-package/entry-point/entry-point.transform.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,+BAAiC;AACjC,2CAA8C;AAE9C,qDAAuC;AACvC,oCAAkD;AAElD;;;;;;;;;;;;;;;;;;;;;;;;GAwBG;AACI,MAAM,0BAA0B,GAAG,CACxC,SAAoB,EACpB,YAAuB,EACvB,YAAuB,EACZ,EAAE,CACb,IAAA,WAAI,EACF,IAAA,UAAG,EAAC,KAAK,CAAC,EAAE;IACV,4CAA4C;IAC5C,MAAM,UAAU,GAAG,KAAK,CAAC,IAAI,CAAC,IAAA,8BAAsB,GAAE,CAAC,CAAC;IACxD,GAAG,CAAC,GAAG,CAAC,kFAAkF,CAAC,CAAC;IAC5F,GAAG,CAAC,GAAG,CAAC,yBAAyB,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,CAAC,CAAC;IACzE,GAAG,CAAC,GAAG,CAAC,gFAAgF,CAAC,CAAC;AAC5F,CAAC,CAAC;AACF,iCAAiC;AACjC,SAAS;AACT,+CAA+C;AAC/C,YAAY,EACZ,YAAY,EACZ,IAAA,UAAG,EAAC,KAAK,CAAC,EAAE;IACV,MAAM,UAAU,GAAG,KAAK,CAAC,IAAI,CAAC,IAAA,8BAAsB,GAAE,CAAC,CAAC;IACxD,UAAU,CAAC,KAAK,GAAG,iBAAU,CAAC;AAChC,CAAC,CAAC,CACH,CAAC;AAtBS,QAAA,0BAA0B,8BAsBnC","sourcesContent":["import { pipe, tap } from 'rxjs';\nimport { STATE_DONE } from '../../graph/node';\nimport { Transform } from '../../graph/transform';\nimport * as log from '../../utils/log';\nimport { isEntryPointInProgress } from '../nodes';\n\n/**\n * A re-write of the `transformSources()` script that transforms an entry point from sources to distributable format.\n *\n * Sources are TypeScript source files accompanied by HTML templates and xCSS stylesheets.\n * See the Angular Package Format for a detailed description of what the distributables include.\n *\n * The current transformation pipeline can be thought of as:\n *\n *  - clean\n *  - compileTs\n *  - downlevelTs\n *  - writeBundles\n *    - bundleToFesm15\n *  - relocateSourceMaps\n *  - writePackage\n *   - copyStagedFiles (bundles, esm, dts, sourcemaps)\n *   - writePackageJson\n *\n * The transformation pipeline is pluggable through the dependency injection system.\n * Sub-transformations are passed to this factory function as arguments.\n *\n * @param compileTs Transformation compiling typescript sources to ES2022 modules.\n * @param writeBundles Transformation flattening ES2022 modules to ESM2022, UMD, and minified UMD.\n * @param writePackage Transformation writing a distribution-ready `package.json` (for publishing to npm registry).\n */\nexport const entryPointTransformFactory = (\n  compileTs: Transform,\n  writeBundles: Transform,\n  writePackage: Transform,\n): Transform =>\n  pipe(\n    tap(graph => {\n      // Peek the first entry point from the graph\n      const entryPoint = graph.find(isEntryPointInProgress());\n      log.msg('\\n------------------------------------------------------------------------------');\n      log.msg(`Building entry point '${entryPoint.data.entryPoint.moduleId}'`);\n      log.msg('------------------------------------------------------------------------------');\n    }),\n    // TypeScript sources compilation\n    compileTs,\n    // After TypeScript: bundling and write package\n    writeBundles,\n    writePackage,\n    tap(graph => {\n      const entryPoint = graph.find(isEntryPointInProgress());\n      entryPoint.state = STATE_DONE;\n    }),\n  );\n"]}